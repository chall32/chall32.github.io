---
layout: post
title: ESXi Command Line Networking Configuration
date: '2012-02-17T17:26:00.001Z'
tags:
- ESXi
- VMware
modified_time: '2012-02-17T17:38:18.462Z'
thumbnail: http://4.bp.blogspot.com/-V5sSzthnnJo/Tz5sTBi8cLI/AAAAAAAABE0/lhons68mjFA/s72-c/splash.jpg
blogger_id: tag:blogger.com,1999:blog-1308168280960455064.post-7135576602598038617
blogger_orig_url: http://chall32.blogspot.com/2012/02/esxi-command-line-networking.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-V5sSzthnnJo/Tz5sTBi8cLI/AAAAAAAABE0/lhons68mjFA/s1600/splash.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="148" src="http://4.bp.blogspot.com/-V5sSzthnnJo/Tz5sTBi8cLI/AAAAAAAABE0/lhons68mjFA/s200/splash.jpg" width="200" /></a></div>Ages and ages ago, I posted an article detailing <a href="http://chall32.blogspot.com/2011/05/esx-command-line-networking.html" target="_blank">ESX Command Line Networking Configuration</a>, and at the bottom of the post I added the sign off "Next time.... ESXi."&nbsp; Well, finally here is said ESXi post: How to configure ESXi networking from the command line.<br /><br />Why?&nbsp; Because there doesnâ€™t appear to be any single place (that I can find at least) where all of the this is detailed.&nbsp; So hold onto you hats, again, here we go... Again!<br /><br /><b><span style="font-size: large;">Changing IP Address, Subnet Mask, Default Gateway, Hostname and DNS Settings (All Versions)</span></b><br />Very simple. Use the console configuration tool:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-r-31mqkkRhY/Tz5nus12QhI/AAAAAAAABEc/pXO9Qic7nKc/s1600/ip.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="177" src="http://4.bp.blogspot.com/-r-31mqkkRhY/Tz5nus12QhI/AAAAAAAABEc/pXO9Qic7nKc/s400/ip.jpg" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-BNWNQ8tEEro/Tz5oAX_hswI/AAAAAAAABEk/aoC8ceGBViY/s1600/dns.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="177" src="http://2.bp.blogspot.com/-BNWNQ8tEEro/Tz5oAX_hswI/AAAAAAAABEk/aoC8ceGBViY/s400/dns.jpg" width="400" /></a></div><br />OK, whilst strictly not "command line", why not use the built in configuration tool? It is far simpler!<br /><br /><i><b>Word of warning - </b>Whilst not prompted for a reboot when changing the ESXi's Hostname, I would complete a reboot anyway.&nbsp; I and others have seen spurious issues later on through ESXi configuration when a post rename reboot has not been completed.</i><br /><br /><b><span style="font-size: large;">Linking and Unlinking Physical Network Cards to Virtual Switches and Network Card Teaming (All Versions)</span></b><br />Again sure you can do this through the console configuration tool for the service console / management vSwitch.&nbsp; However, what happens if you want to make changes on other vSwitches? <br /><br />First lets look at how the vSwitch is configured post install.&nbsp; Screenshot from a VI Client:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-0C9RTeIjrZg/TcQKagXZagI/AAAAAAAAAw4/nDm4i2Qwyds/s1600/ESX.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="125" src="http://3.bp.blogspot.com/-0C9RTeIjrZg/TcQKagXZagI/AAAAAAAAAw4/nDm4i2Qwyds/s400/ESX.JPG" width="400" /></a></div>If you were to view the same information at the service console command line we would use the following command to list the virtual switches configured:<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">esxcfg-vswitch -l</span></blockquote><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-KjMHmONMdhE/TcQLc80u1OI/AAAAAAAAAxA/asno2bhR9Es/s1600/ESX1.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="91" src="http://4.bp.blogspot.com/-KjMHmONMdhE/TcQLc80u1OI/AAAAAAAAAxA/asno2bhR9Es/s400/ESX1.JPG" width="400" /></a></div><br />To connect a physical adaptor to a virtual switch, you need to Link it, using the following command:<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">esxcfg-vswitch -L vmnic1 vSwitch0</span></blockquote>Where vmnic1 is the physical network card being connected to the virtual switch vSwitch0.<br /><br />To disconnect a physical adaptor to a virtual switch, you need to Unlink it, using the following command:<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">esxcfg-vswitch -U vmnic1 vSwitch0</span></blockquote>Where vmnic1 is the physical network card being disconnected from the virtual switch vSwitch0.<br /><br />Basic network card teaming is achieved by having two or more physical adaptors connected to the same virtual switch.&nbsp; From the VI Client:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-R5XLDzKGH54/TcQSfBohmGI/AAAAAAAAAxE/obl5x8Lj_wA/s1600/ESX3.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="117" src="http://3.bp.blogspot.com/-R5XLDzKGH54/TcQSfBohmGI/AAAAAAAAAxE/obl5x8Lj_wA/s400/ESX3.JPG" width="400" /></a></div>&nbsp;Which in turn looks like this from the console:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-k4GaTyqb5OE/TcQSzM6crRI/AAAAAAAAAxI/aMv7ZLF4Z34/s1600/ESX4.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="83" src="http://1.bp.blogspot.com/-k4GaTyqb5OE/TcQSzM6crRI/AAAAAAAAAxI/aMv7ZLF4Z34/s400/ESX4.JPG" width="400" /></a></div><br /><i>Further reading on Linking and Unlinking Physical Network Cards to Virtual Switches: <a href="http://kb.vmware.com/kb/1000258" target="_blank">http://kb.vmware.com/kb/1000258</a></i><br /><br /><span style="font-size: large;"><b>NIC Teaming Policy and Load Balancing (ESXi 4.1 and Earlier)</b></span><br />First lets look at how the vSwitch load balancing configured post install.&nbsp; Screenshot from a VI Client:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-5fQxmy_n6ZA/TcQcqsJBVpI/AAAAAAAAAxY/sHX6pr8Y8kE/s1600/ESX7.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="172" src="http://1.bp.blogspot.com/-5fQxmy_n6ZA/TcQcqsJBVpI/AAAAAAAAAxY/sHX6pr8Y8kE/s400/ESX7.JPG" width="400" /></a></div><br />Which in turn looks like this from the console:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-gri4cGUSbas/Tz5d7kiaq9I/AAAAAAAABEE/Mh6s9YzeWzs/s1600/switchpolicy.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="40" src="http://2.bp.blogspot.com/-gri4cGUSbas/Tz5d7kiaq9I/AAAAAAAABEE/Mh6s9YzeWzs/s400/switchpolicy.jpg" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/--7RU6QttP8k/TcQWtRWLSKI/AAAAAAAAAxQ/CzVrJChDtew/s1600/ESX6.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"></a></div>To specify the NIC teaming load balancing policy on a vSwitch, run the command:<br /><div style="text-align: left;"><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">vim-cmd /hostsvc/net/vswitch_setpolicy --nicteaming-policy='</span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">[policy]</span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">' vSwitch0</span></blockquote></div>Where [policy] is one of these NIC teaming policies:<br /><ul><li>loadbalance_srcid (Route based on the originating virtual switch port ID)</li><li>loadbalance_srcmac (Route based on source MAC hash)</li><li>loadbalance_ip (Route based on IP hash)</li><li>failover_explicit (Use explicit failover order)</li></ul>For example, to set the NIC teaming policy to route based on IP hash, run the command:<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">vim-cmd /hostsvc/net/vswitch_setpolicy --nicteaming-policy='loadbalance_ip' vSwitch0</span></blockquote>To confirm the setting, run the command:<br /><blockquote style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">vim-cmd /hostsvc/net/vswitch_info vSwitch0 | grep policy</span></blockquote>When run on console:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-KX3IH9jHv7Q/Tz5gNA5fNHI/AAAAAAAABEM/dNacJWeJpp4/s1600/loadbalnce.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="57" src="http://2.bp.blogspot.com/-KX3IH9jHv7Q/Tz5gNA5fNHI/AAAAAAAABEM/dNacJWeJpp4/s400/loadbalnce.jpg" width="400" /></a></div><br /><span style="font-size: large;"><b>NIC Teaming Policy and Load Balancing (ESXi 5.0 and Later)</b></span><br />To specify the NIC teaming load balancing policy on a vSwitch, run the command:<br /><div style="text-align: left;"><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">esxcli network vswitch standard policy failover set -l [policy] -v vSwitch0</span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"></span></blockquote></div>Where [policy] is one of these NIC teaming policies:<br /><ul><li>portid (Route based on the originating virtual switch port ID)</li><li>mac (Route based on source MAC hash)</li><li>iphash (Route based on IP hash)</li><li>explicit (Use explicit failover order)</li></ul>For example, to set the NIC teaming policy to route based on originating switch port ID, run the command:<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">esxcli network vswitch standard policy failover set -l portid -v vSwitch0</span></blockquote>To confirm the setting, run the command:<br /><blockquote style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">esxcli network vswitch standard policy failover get -v vSwitch0</span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"></span></blockquote>When run on console:<br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-EQQoMTlM8l8/Tz5p6a8RBkI/AAAAAAAABEs/MshjSFciuxk/s1600/switchpolicy5.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="101" src="http://1.bp.blogspot.com/-EQQoMTlM8l8/Tz5p6a8RBkI/AAAAAAAABEs/MshjSFciuxk/s400/switchpolicy5.jpg" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-KX3IH9jHv7Q/Tz5gNA5fNHI/AAAAAAAABEM/dNacJWeJpp4/s1600/loadbalnce.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"></a></div><i>Further reading on NIC Teaming Policy and Load Balancing: <a href="http://kb.vmware.com/kb/1011520" target="_blank">http://kb.vmware.com/kb/1011520</a></i><br /><br /><span style="font-size: large;"><b>VLAN Tagging </b></span><b><span style="font-size: large;"> (All Versions)</span></b><br />Use the following command to assign a VLAN to a console port / port group<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">esxcfg-vswitch -v [VLANID] -p "Management Network" vSwitch0</span></blockquote>Where [VLANID] is the VLAN number, "Management Network" is the console port / port group name and vSwitch0 is the virtual switch the console port / port group is connected to.&nbsp; A zero [VLANID] here specifies no VLAN.<br /><br /><i>Further reading on VLAN Tagging: <a href="http://kb.vmware.com/kb/1000258" target="_blank">http://kb.vmware.com/kb/1000258</a> </i><br /><br /><span style="font-size: large;"><b>Overview </b></span><br />In this post we looked at how to configure the following, all from the ESXi console, no VI client required!<br /><ul><li>Changing IP Address, Subnet Mask, Default Gateway, Hostname and DNS Server Settings </li><li>Linking and Unlinking Physical Network Cards to Virtual Switches and Network Card Teaming </li><li>NIC Teaming Policy and Load Balancing</li><li>VLAN Tagging </li></ul><br />- Chris<div class="blogger-post-footer"><p>

