---
layout: post
title: Adding VLANs to Cisco Nexus 1000v
date: '2012-11-08T12:25:00.000Z'
tags:
- ESXi
- VMware
- Cisco
modified_time: '2012-11-08T12:25:00.054Z'
thumbnail: https://lh3.ggpht.com/-KmPQr_l25Kk/UIEe1VuLYFI/AAAAAAAABRI/E-aWVnV5TdY/s72-c/ciscovmware.jpg
blogger_id: tag:blogger.com,1999:blog-1308168280960455064.post-8431340963568642026
blogger_orig_url: http://chall32.blogspot.com/2012/11/adding-vlans-to-cisco-nexus-1000v.html
---

<div class="ssmainhide"><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-KmPQr_l25Kk/UIEe1VuLYFI/AAAAAAAABRI/E-aWVnV5TdY/s1600/ciscovmware.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="200" src="https://lh3.ggpht.com/-KmPQr_l25Kk/UIEe1VuLYFI/AAAAAAAABRI/E-aWVnV5TdY/s400/ciscovmware.jpg" width="200" /></a></div></div>Having scoured the internet and drawing a blank when looking&nbsp; for a simple process to follow when adding a VLAN and subsequent VMware VM access port group and to a Cisco Nexus 1000v switch, I ended up stitching together the Cisco commands after reading lots and lots of Cisco Nexus configuration guides.<br /><br />The annoyance is that whilst you can monitor the configuration of your Nexus 1000v through VMware Virtual Center, you cannot configure it.&nbsp; All Nexus 1000v configuration must be done at the command line. <br /><br />In this post I present to you the configuration commands I use when adding an additional VLAN to a Nexus 1000v switch.<br /><h2>First off - What is a Cisco Nexus 1000v?</h2>Well if you have a spare 5 minutes and 17 seconds, have a watch of the following:<br /><br /><div class="separator" style="clear: both; text-align: center;"><iframe allowfullscreen="allowfullscreen" frameborder="0" height="315" src="http://www.youtube.com/embed/vrZpYS6vEY4" width="420"></iframe></div><br />If not, put simply a Nexus 1000v replaces / augments a standard VMware distributed switch as shown below:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-sHy40rtY0pI/UIEySiyqdMI/AAAAAAAABRg/1jsjOoaoJ00/s1600/vem_install_n1000v-1.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://lh3.ggpht.com/-sHy40rtY0pI/UIEySiyqdMI/AAAAAAAABRg/1jsjOoaoJ00/s1600/vem_install_n1000v-1.jpg" /></a></div><br />A single Nexus 1000v consists of a minimum of 2 modules:<br /><br />VEM = Virtual Ethernet Module - Installed on the ESXi host itself<br />VSM = Virtual Supervisor Module - The 1000v management VM<br /><h2>Setting up a Nexus 1000v</h2>Have a read of Kendrick Coleman's excellent guide here: <a href="http://kendrickcoleman.com/index.php/Tech-Blog/standing-up-the-cisco-nexus-1000v-in-less-than-10-minutes.html" target="_blank">Standing Up The Cisco Nexus 1000v In Less Than 10 Minutes</a><br /><br />Of course, if you were setting your Nexus 1000v from scratch, you would know which VLANs to add 'right off the bat', so would have no need to add additional VLANs.<br /><br />However as we all know change happens.<br /><h2>Adding VLANs to Cisco Nexus 1000v</h2>Yes, I'm not a network administrator, however these commands work for me.&nbsp; They should work for you too.<br /><h3>Create a VLAN and name it correctly:</h3>First step is to create a VLAN and give it a name.&nbsp; I like to name my VLANs in line with their VMware port group name.&nbsp; Here I'm creating VLAN 456 and calling it "VM_Prod_VL456":<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; conf t</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>vlan 456</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>name VM_Prod_VL456</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>end</span><br /><h3>Create a VMware Access Port Group and give it a friendly name</h3>Next step is to create the VMware port group as it would appear in Virtual Center Networking.&nbsp; Here I'm calling my VMware port group "VM_Prod_VL456" and hooking it to my VLAN 456.&nbsp; I'm also going to give my "VM_Prod_VL456" port group 512 access ports to plug my VMs into:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>conf t</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>port-profile type vethernet VM_Prod_VL456</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>vmware port-group</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>switchport mode access</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>switchport access vlan 456</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>vmware max-ports 512</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>no shutdown</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>state enabled</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>end</span><br /><h3>Add VLAN to the trunk port group<b> </b></h3>Final step is to allow the newly crated VLAN 456 access to the rest of the network via the ESXi physical network cards.&nbsp; Sometimes referred to as the Nexus 1000v trunk ports.&nbsp; In my example, these ports are called&nbsp; "SYSTEM-UPLINK".&nbsp; I'm also going to save my configuration via "copy run start":<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>conf t</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>port-profile SYSTEM-UPLINK</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>switchport trunk allowed vlan add 456</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>end</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp; </span>copy run start</span><br /><br />Job done.&nbsp; Time to start creating some VM's and hooking them into my newly created "VM_Prod_VL456" port group.<br /><br />- Chris <div class="blogger-post-footer"><p>

