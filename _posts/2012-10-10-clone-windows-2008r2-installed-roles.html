---
layout: post
title: Clone Windows Installed Roles and Features
date: '2012-10-10T17:39:00.000+01:00'
tags:
- Windows 2008
modified_time: '2012-12-13T11:23:04.376Z'
thumbnail: https://lh3.ggpht.com/-KqwdAHO0k3c/UHWkAiRHHTI/AAAAAAAABOY/gVtVeDyJk14/s72-c/RollsFeatures.jpg
blogger_id: tag:blogger.com,1999:blog-1308168280960455064.post-2926383174373810151
blogger_orig_url: http://chall32.blogspot.com/2012/10/clone-windows-2008r2-installed-roles.html
---

<table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; margin-left: 1em; text-align: right;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-KqwdAHO0k3c/UHWkAiRHHTI/AAAAAAAABOY/gVtVeDyJk14/s1600/RollsFeatures.jpg" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" src="https://lh3.ggpht.com/-KqwdAHO0k3c/UHWkAiRHHTI/AAAAAAAABOY/gVtVeDyJk14/s1600/RollsFeatures.jpg" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Mmmm a Roll with a Ham Feature...</td></tr></tbody></table><br />Quite often I'm asked to build servers that need to have identical configurations in terms of the Windows roles and features installed.<br /><br /><br />Firstly, What are server roles, role services, and features?&nbsp; Have a <a href="http://technet.microsoft.com/en-us/library/cc754923.aspx" target="_blank">look at this article</a> to understand roles and features and the difference between a Windows role and a Windows feature.<br /><br /><br /><h2>Export and Import of Windows Roles and Features</h2>OK, so I've manually installed a selection of required roles and features on the first of my servers and that server is working perfectly.&nbsp; How can I export a list of roles and features installed on the working server so that I can build the second server?<br /><br /><b>Powershell to the rescue!</b><br />This is where the powershell <a href="http://technet.microsoft.com/library/cc731774.aspx" target="_blank">Server Manager Module</a> comes into it's own.&nbsp; It has three handy cmdlets, they are:<br /><ul><li>Add-WindowsFeature</li><li>Get-WindowsFeature</li><li>Remove-WindowsFeature</li></ul>&nbsp;Lets look at the Server Manager Module in action: <br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">PS&gt; Import-Module Servermanager</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">PS&gt; Get-Command -Module Servermanager</span><br /><div class="separator" style="clear: both; text-align: center;"></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-Z_SnDxHxWMU/UHWXlRS560I/AAAAAAAABNQ/RtbEvCs2tJM/s1600/get-command-windowsfeature.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="136" src="https://lh3.ggpht.com/-Z_SnDxHxWMU/UHWXlRS560I/AAAAAAAABNQ/RtbEvCs2tJM/s1600/get-command-windowsfeature.JPG" width="400" /></a></div><br />So if we list all installable modules:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">PS&gt; Get-WindowsFeature</span><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-JdUKXELnq50/UHWX7C1zWRI/AAAAAAAABNY/Sn_Jm4-gAMg/s1600/Get-WindowsFeature.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="283" src="https://lh3.ggpht.com/-JdUKXELnq50/UHWX7C1zWRI/AAAAAAAABNY/Sn_Jm4-gAMg/s1600/Get-WindowsFeature.jpg" width="400" /></a></div><br />Lots and lots!&nbsp; OK lets pair this down and see if we can list only those roles and feature installed.&nbsp; We use this command:<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">PS&gt; Get-WindowsFeature | ? { $_.Installed }</span><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-cofkkYM8SfY/UHWYncmaZ5I/AAAAAAAABNg/cQBVA2YK-0E/s1600/Get-WindowsFeatureInstalled.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="282" src="https://lh3.ggpht.com/-cofkkYM8SfY/UHWYncmaZ5I/AAAAAAAABNg/cQBVA2YK-0E/s1600/Get-WindowsFeatureInstalled.jpg" width="400" /></a></div><br />Nice.&nbsp; Now we know which roles and features are installed. Handy for documentation or comparison.<br /><br /><h2>HOW TO: Export Installed Roles and Features to File</h2>Firstly you need to export that nice list obtained above into something structured that can be used by the other server to install the required roles and features.&nbsp; For this we use the <a href="http://technet.microsoft.com/library/hh849916" target="_blank">Export-Clixml</a> cmdlet.&nbsp; This will allow us to export the list of installed roles and features into an xml file. Here is the command with the xml creation:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">PS&gt; Get-WindowsFeature | ? { $_.Installed -AND $_.SubFeatures.Count -eq 0 } | Export-Clixml .\RnF.xml</span><br /><br />The resulting xml file looks like this:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-EKpEJLW59M0/UHWckQuBDOI/AAAAAAAABN4/n9e-DkJBRmk/s1600/rnfxml.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="https://lh3.ggpht.com/-EKpEJLW59M0/UHWckQuBDOI/AAAAAAAABN4/n9e-DkJBRmk/s1600/rnfxml.jpg" width="400" /></a></div><br />OK, lets copy this xml file over to our target server ready for the import.<br /><br /><h2>&nbsp;HOW TO: Install Roles and Features from File</h2>Dead simple, using the <a href="http://technet.microsoft.com/en-US/library/hh849906" target="_blank">Import-Clixml</a> cmdlet:<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: inherit;">&nbsp;</span> </span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">PS&gt; Import-Module Servermanager<br />PS&gt; Import-Clixml .\RnF.xml | Add-WindowsFeature</span><br /><br />Quick check in Server Manager GUI:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-YHBhst2o3kU/UHWh8oQ5oSI/AAAAAAAABOQ/ziDsZWhE8AQ/s1600/AllDone.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="346" src="https://lh3.ggpht.com/-YHBhst2o3kU/UHWh8oQ5oSI/AAAAAAAABOQ/ziDsZWhE8AQ/s1600/AllDone.jpg" width="400" /></a></div><br />Looks Good. Job done!<br /><br /><br />So there you have it then. Two commands, one piece of xml, two servers running the exact same set of roles and features.<br /><br />- Chris <br /><br /><div class="blogger-post-footer"><p>

