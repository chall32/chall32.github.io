---
comments: true
layout: post
title: ESX Command Line Networking Configuration
date: '2011-05-06T18:00:00.003+01:00'
tags:
- VMware
- ESX
modified_time: '2012-02-17T20:35:31.609Z'
thumbnail: http://1.bp.blogspot.com/-kb_F98Id4JE/TcQZJcyDWWI/AAAAAAAAAxU/g-vIWe8wYqk/s72-c/console.JPG
blogger_id: tag:blogger.com,1999:blog-1308168280960455064.post-8135900136121253314
blogger_orig_url: http://chall32.blogspot.com/2011/05/esx-command-line-networking.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-kb_F98Id4JE/TcQZJcyDWWI/AAAAAAAAAxU/g-vIWe8wYqk/s1600/console.JPG" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="150" src="http://1.bp.blogspot.com/-kb_F98Id4JE/TcQZJcyDWWI/AAAAAAAAAxU/g-vIWe8wYqk/s200/console.JPG" width="200" /></a></div><br />So you’ve built your VMware ESX server and your dead impressed with yourself that you got this far.&nbsp; You leave the datacentre head back to the office safe in the knowledge that the install went well.&nbsp; However once safely back at your desk, oh no! You find that you shiny new ESX install is uncontactable from the network.<br /><br /><br />We’ve all been there.&nbsp; So here is my guide to configuring ESX networking from the server console post install.&nbsp; No VI client or GUI tools required.&nbsp; Just good solid command-line stuff.&nbsp; Specifically we will be looking at:<br /><br /><ul><li>Changing IP Address, Subnet Mask, Default Gateway, Hostname and DNS Server Settings </li><li>Linking and Unlinking Physical Network Cards to Virtual Switches and Network Card Teaming </li><li>VLAN Tagging </li><li>NIC Teaming Policy and Load Balancing</li></ul><br />Why?&nbsp; Because there doesn’t appear to be any single place (that I can find at least) where all of the this is detailed.&nbsp; So hold onto you hats, here we go. <br /><br /><b>UPDATE: </b>For ESXi Command Line Networking Configuration see <a href="http://chall32.blogspot.com/2012/02/esxi-command-line-networking.html" target="_blank">THIS POST</a><br /><br /><span style="font-size: large;"><b>Changing IP Address, Subnet Mask, Default Gateway, DNS Server Settings and Hostname</b></span><br />Happens to us all.&nbsp; Perhaps you just ‘fat fingered’ the IP?&nbsp; Use <br /><br /><blockquote><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">[root@server root]# ifconfig |more </div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">[root@server root]# cat /etc/sysconfig/network</div></blockquote>to confirm that IP config is indeed wrong<br /><br /><b>IP Address / Subnet Mask</b><br />Run this command to set the IP address:<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">[root@server root]# e</span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">sxcfg-vswif -i [a.b.c.d] -n [w.x.y.z] vswif0 </span></blockquote>Where [a.b.c.d] is the IP address and [w.x.y.z] is the subnet mask and vswif0 is the Service Console adapter that is the interface to which you are applying the IP address change.<br /><br />Open the /etc/hosts file with nano and modify it so that it reflects the correct IP address and hostname. <br /><br /><b>Default Gateway</b><br />To change the default gateway address and the hostname, edit the /etc/sysconfig/network file and change the GATEWAY and HOSTNAME parameters to the proper values.&nbsp; For the changes to take place, reboot the host or restart the network service with the command:<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">[root@server root]# service network restart </span></blockquote><br /><b>DNS Server Settings<br /></b> To change the DNS server settings, update the nameserver IPs and search domain in the /etc/resolv.conf file.<br /><br /><i>Further reading on Changing IP Address, Subnet Mask, Default Gateway, DNS Server Settings: <a href="http://kb.vmware.com/kb/4309499" target="_blank">http://kb.vmware.com/kb/4309499</a></i><br /><br /><b>Hostname</b> <br />Change the hostname and domain name (if applicable) of the host in the following files:<br /><ul><li>/etc/hosts</li><li>/etc/sysconfig/network</li></ul>Execute this command where [hostname] is the new hostname for the ESX host:<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">[root@server root]# esxcfg-advcfg -s [hostname] /Misc/HostName</span></blockquote>Reboot the ESX host<br /><i>Further reading on Changing ESX Hostname: <a href="http://kb.vmware.com/kb/1010821" target="_blank">http://kb.vmware.com/kb/1010821</a></i><br /><br /><br /><span style="font-size: large;"><b>Linking and Unlinking Physical Network Cards to Virtual Switches and Network Card Teaming</b></span><br />This is possibly my most used ESX console command.&nbsp; Often used when there has been a cabling mix up or the software installation has detected the physical network adaptors in a different order than anticipated prior to the install.&nbsp; Sure I could just swap cables around, but if physical changes are not possible (i.e.cabling is as documented or moving cables is not allowed) then these commands will help.<br /><br />First lets look at how the vSwitch is configured post install.&nbsp; Screenshot from a VI Client:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-0C9RTeIjrZg/TcQKagXZagI/AAAAAAAAAw4/nDm4i2Qwyds/s1600/ESX.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="125" src="http://3.bp.blogspot.com/-0C9RTeIjrZg/TcQKagXZagI/AAAAAAAAAw4/nDm4i2Qwyds/s400/ESX.JPG" width="400" /></a></div>If you were to view the same information at the service console command line we would use the following command to list the virtual switches configured:<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">[root@server root]# esxcfg-vswitch -l</span></blockquote><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-KjMHmONMdhE/TcQLc80u1OI/AAAAAAAAAxA/asno2bhR9Es/s1600/ESX1.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="146" src="http://4.bp.blogspot.com/-KjMHmONMdhE/TcQLc80u1OI/AAAAAAAAAxA/asno2bhR9Es/s640/ESX1.JPG" width="640" /></a></div><br />To connect a physical adaptor to a virtual switch, you need to Link it, using the following command:<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">[root@server root]# esxcfg-vswitch -L vmnic1 vSwitch0</span></blockquote>Where vmnic1 is the physical network card being connected to the virtual switch vSwitch0.<br /><br />To disconnect a physical adaptor to a virtual switch, you need to Unlink it, using the following command:<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">[root@server root]# esxcfg-vswitch -U vmnic1 vSwitch0</span></blockquote>Where vmnic1 is the physical network card being disconnected from the virtual switch vSwitch0.<br /><br />Basic network card teaming is achieved by having two or more physical adaptors connected to the same virtual switch.&nbsp; From the VI Client:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-R5XLDzKGH54/TcQSfBohmGI/AAAAAAAAAxE/obl5x8Lj_wA/s1600/ESX3.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="117" src="http://3.bp.blogspot.com/-R5XLDzKGH54/TcQSfBohmGI/AAAAAAAAAxE/obl5x8Lj_wA/s400/ESX3.JPG" width="400" /></a></div>&nbsp;Which in turn looks like this from the console:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-k4GaTyqb5OE/TcQSzM6crRI/AAAAAAAAAxI/aMv7ZLF4Z34/s1600/ESX4.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="132" src="http://1.bp.blogspot.com/-k4GaTyqb5OE/TcQSzM6crRI/AAAAAAAAAxI/aMv7ZLF4Z34/s640/ESX4.JPG" width="640" /></a></div><br /><i>Further reading on Linking and Unlinking Physical Network Cards to Virtual Switches: <a href="http://kb.vmware.com/kb/1000258" target="_blank">http://kb.vmware.com/kb/1000258</a></i><br /><br /><br /><span style="font-size: large;"><b>VLAN Tagging</b></span><br />&nbsp;Use the following command to assign a VLAN to a console port / port group<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;[root@server root]# esxcfg-vswitch -v [VLAN] -p “Service Console” vSwitch0</span></blockquote>Where [VLANID] is the VLAN number, "Service Console" is the console port / port group name and vSwitch0 is the virtual switch the console port / port group is connected to.&nbsp; A zero [VLANID] here specifies no VLAN.<br /><br /><i>Further reading on VLAN Tagging: <a href="http://kb.vmware.com/kb/1000258" target="_blank">http://kb.vmware.com/kb/1000258</a> </i><br /><br /><br /><span style="font-size: large;"><b>NIC Teaming Policy and Load Balancing</b></span><br />First lets look at how the vSwitch load balancing configured post install.&nbsp; Screenshot from a VI Client:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-5fQxmy_n6ZA/TcQcqsJBVpI/AAAAAAAAAxY/sHX6pr8Y8kE/s1600/ESX7.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="272" src="http://1.bp.blogspot.com/-5fQxmy_n6ZA/TcQcqsJBVpI/AAAAAAAAAxY/sHX6pr8Y8kE/s640/ESX7.JPG" width="640" /></a></div><br />Which in turn looks like this from the console:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/--7RU6QttP8k/TcQWtRWLSKI/AAAAAAAAAxQ/CzVrJChDtew/s1600/ESX6.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="98" src="http://1.bp.blogspot.com/--7RU6QttP8k/TcQWtRWLSKI/AAAAAAAAAxQ/CzVrJChDtew/s640/ESX6.JPG" width="640" /></a></div><br />&nbsp;To specify the NIC teaming load balancing policy on a vSwitch, run the command:<br /><div style="text-align: left;"><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">[root@server root]# vimsh -n -e "hostsvc/net/vswitch_setpolicy --nicteaming-policy [policy] vSwitch0"</span></blockquote></div>Where [policy] is one of these NIC teaming policies:<br /><br /><ul><li>loadbalance_srcid (Route based on the originating virtual switch port ID)</li><li>loadbalance_srcmac (Route based on source MAC hash)</li><li>loadbalance_ip (Route based on IP hash)</li><li>failover_explicit (Use explicit failover order)</li></ul><br />For example, to set the NIC teaming policy to route based on IP hash, run the command:<br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">[root@server root]# vimsh -n -e "hostsvc/net/vswitch_setpolicy --nicteaming-policy loadbalance_ip vSwitch0"</span></blockquote>To confirm the setting, run the command:<br /><blockquote style="font-family: &quot;Courier New&quot;,Courier,monospace;">[root@server root]# vimsh -n -e "hostsvc/net/vswitch_info vSwitch0" | grep policy</blockquote><i>Further reading on NIC Teaming Policy and Load Balancing: <a href="http://kb.vmware.com/kb/1019864" target="_blank">http://kb.vmware.com/kb/1019864</a></i><br /><br /><br /><span style="font-size: large;"><b>Overview </b></span><br />In this post we looked at how to configure the following, all from the ESX console, no VI client required!<br /><br /><ul><li>Changing IP Address, Subnet Mask, Default Gateway, Hostname and DNS Server Settings </li><li>Linking and Unlinking Physical Network Cards to Virtual Switches and Network Card Teaming </li><li>VLAN Tagging </li><li>NIC Teaming Policy and Load Balancing</li></ul><br />Next time.... ESXi.<br /><br />- Chris<div class="blogger-post-footer"><p>

