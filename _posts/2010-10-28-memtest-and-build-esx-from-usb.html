---
layout: post
title: Memtest and Build ESX from USB
date: '2010-10-28T21:26:00.002+01:00'
tags:
- USB
- ESXi
- VMware
- ESX
modified_time: '2010-10-28T21:34:44.853+01:00'
thumbnail: http://1.bp.blogspot.com/_2xKZgKYJlJs/TI_Xt8_cMZI/AAAAAAAAAsc/JOT9EE3XDys/s72-c/esxusb2.png
blogger_id: tag:blogger.com,1999:blog-1308168280960455064.post-495279645416501724
blogger_orig_url: http://chall32.blogspot.com/2010/10/memtest-and-build-esx-from-usb.html
---

<div class="separator" style="clear: both; text-align: left;"><a href="http://1.bp.blogspot.com/_2xKZgKYJlJs/TI_Xt8_cMZI/AAAAAAAAAsc/JOT9EE3XDys/s1600/esxusb2.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img alt="VMware ESX 4 Installation USB Stick - Now with Memtest86+!" border="0" src="http://1.bp.blogspot.com/_2xKZgKYJlJs/TI_Xt8_cMZI/AAAAAAAAAsc/JOT9EE3XDys/s1600/esxusb2.png" title="VMware ESX 4 Installation USB Stick - Now with Memtest86+!" /></a></div><b>REDUX</b> <i>Adj:</i> Brought back; returned.&nbsp; Used postpositively.<br /><br />Back in November last year, I showed you how to easily create a VMware ESX4.x Installation USB using an empty USB stick, UNetbootin and a copy of the ESX installation ISO. (<a href="http://chall32.blogspot.com/2009/11/vmware-esx-4-install-from-usb.html" target="_blank">here</a>)<br /><br />Since then the post has gone from strength to strength and has proved to be among the top five all time most popular posts on this blog.&nbsp; Cheers all - glad you liked it! <br /><br />So, a quick update post on how to increase the use of your ESX4.x installation USB by also incorporating Memtest86+ onto your USB stick.<br /><br /><br /><br /><span style="font-size: large;"><b>Memtest86+</b></span><br /><i>What is Memtest86+? </i><br />Memtest86+ is a thorough, standalone memory test tool for x86 architecture computers.&nbsp; The sole purpose of the tool is to test and provide detailed information memory on memory failures detected.&nbsp; It is written and maintained by Samuel Demeulemeesteris and is in turn based on the original memtest86, written by Chris Brady.&nbsp; Further details can be found at <a href="http://www.memtest.org/" target="_blank">http://www.memtest.org/</a><br /><br /><i>Why do I need it?&nbsp; Why test memory?</i><br />By it's very nature VMware ESX is tough on memory.&nbsp; Lets think for a second; at any one time your typical ESX server is going to be hosting multiple virtual machines with each VM running its own operating system and application stack.&nbsp; In turn, each VM is going to demand and utilise memory as and when it needs it.&nbsp; ESX's job is to juggle this demand to allow for smooth running of the VMs. A job it does very well.<br /><br />Add to that the fact that when building high end ESX servers, memory configurations start to get slightly 'obscene'.&nbsp; Some of the recent ESX builds I've been involved with are pushing 500Gb of memory per server (yes, that's right half a terabyte! of memory!!)&nbsp; With this amount of memory per server the odds of having a faulty memory module increase several fold. <br /><br />Lastly, ESX 4.1 incorporates a new feature: <a href="http://ntpro.nl/blog/archives/1509-vSphere-4.1-Memory-Enhancements-Compression.html" target="_blank">Memory Compression</a>.&nbsp; So, all in all, having known good memory fitted to your ESX is a very good idea indeed.&nbsp; How do we confirm we have good memory fitted to our ESX before we commission it?&nbsp; We test the memory with Memtest86+!<br /><br />OK, lets do this thing.<br /><br /><br /><span style="font-size: large;"><b>Adding Memtest86+</b></span><br />Firstly, you need to create your ESX4.x USB installation media.&nbsp; Follow the process in my original post <a href="http://chall32.blogspot.com/2009/11/vmware-esx-4-install-from-usb.html" target="_blank">here</a>.<br /><br />Next, you need to download a bootable version of the Memtest binary from the memtest website.&nbsp; Specifically, the version you need is the <i>Pre-Compiled Bootable Binary (.zip)</i> from <a href="http://www.memtest.org/#downiso" target="_blank">here</a>.<br /><br />Once downloaded, open the zip and extract the .bin file to the root folder of your ESX4.x installation USB.&nbsp; I rename the file to memtest86 for simplicity.<br /><br />Lastly, you need to add Memtest86+ to the USB boot menu.&nbsp; This is done by again editing the syslinux.cfg found in the root folder of the USB.&nbsp; Here is an example of the specific menu entry that calls and boots Memtest86+:<br /><br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">label ubnentry0</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">menu label Test Memory with Memtest86+ v4.10</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">kernel /memtest86</span></blockquote><br />Which makes my complete syslinux.cfg boot menu look like this:<br /><br /><blockquote><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">default menu.c32</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">prompt 0</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">menu title Chris' VMware ESX4.0 Update 2 USB</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">timeout 100</span><br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">label unetbootindefault</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">menu label Test Memory with Memtest86+ v4.10</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">kernel /memtest86</span><br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">label ubnentry0</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">menu label Install ESX in graphical mode</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">kernel /isolinux/vmlinuz</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">append initrd=/isolinux/initrd.img vmkopts=debugLogToSerial:1 mem=512M quiet askmedia</span><br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">label ubnentry1</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">menu label Install ESX in text mode</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">kernel /isolinux/vmlinuz</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">append initrd=/isolinux/initrd.img vmkopts=debugLogToSerial:1 mem=512M text quiet askmedia</span><br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">label ubnentry2</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">menu label ESX Scripted Install using USB ks.cfg</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">kernel /isolinux/vmlinuz</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">append initrd=/isolinux/initrd.img vmkopts=debugLogToSerial:1 mem=512M ks=usb quiet askmedia</span><br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">label ubnentry3</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">menu label ESX Scripted Install to first disk</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">kernel /isolinux/vmlinuz</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">append initrd=/isolinux/initrd.img vmkopts=debugLogToSerial:1 mem=512M ks=file:///usr/lib/vmware/weasel/examples/ks-first-safe.cfg quiet askmedia</span><br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">label ubnentry4</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">menu label ESX Scripted Install to first disk (overwrite VMFS)</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">kernel /isolinux/vmlinuz</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">append initrd=/isolinux/initrd.img vmkopts=debugLogToSerial:1 mem=512M ks=file:///usr/lib/vmware/weasel/examples/ks-first.cfg quiet askmedia</span><br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">label ubnentry5</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">menu label Boot from first hard disk</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">kernel /ubnkern</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">append initrd=/ubninit </span></blockquote><br />Which in turn looks like this once booted:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/_2xKZgKYJlJs/TMnZuMfyI-I/AAAAAAAAAss/fTA22WhSDbk/s1600/bootmenu.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img alt="Chris' VMware ESX4.0 Update 2 USB - what else? ;o)" border="0" height="352" src="http://4.bp.blogspot.com/_2xKZgKYJlJs/TMnZuMfyI-I/AAAAAAAAAss/fTA22WhSDbk/s640/bootmenu.png" title="Chris' VMware ESX4.0 Update 2 USB - what else? ;o)" width="640" /></a></div><br />Sure I could have more of a fancy menu with funky text and wizzy background images etc, but that's for someone else to play with.&nbsp; I prefer functionality over guff ;o)<br /><br />Simply swap the menu entries around if you would rather have the ESX installer as your default boot option.<br /><br />- Chris<div class="blogger-post-footer"><p>

