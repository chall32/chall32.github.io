---
layout: post
title: ! 'BSOD Debugging Part 2: Debugging'
date: '2012-10-23T17:18:00.000+01:00'
tags:
- XP
- Windows 2008
- Windows 7
modified_time: '2012-10-23T17:18:32.301+01:00'
thumbnail: https://lh3.ggpht.com/-jnFU2TCRsJ0/UH10HffLkaI/AAAAAAAABQo/f-d9QSGyNFg/s72-c/BSOD.jpg
blogger_id: tag:blogger.com,1999:blog-1308168280960455064.post-2321544077591368247
blogger_orig_url: http://chall32.blogspot.com/2012/10/bsod-debugging-part-2-debugging.html
---

<div class="ssmainhide"><a href="http://3.bp.blogspot.com/-jnFU2TCRsJ0/UH10HffLkaI/AAAAAAAABQo/f-d9QSGyNFg/s1600/BSOD.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://lh3.ggpht.com/-jnFU2TCRsJ0/UH10HffLkaI/AAAAAAAABQo/f-d9QSGyNFg/s1600/BSOD.jpg" /></a></div>Check out <a href="http://chall32.blogspot.com/2012/10/bsod-debugging-part-1-setup.html" target="_blank">BSOD Debugging: Part 1</a> if you missed it.&nbsp; OK, so you have your Windows debugging environment set up and you have a dump file to analyse. Lets get on with it!<br /><span style="color: #3d85c6;"><br /></span><span style="color: #3d85c6;"><i><b>Here I will show you how I use the debugger to get to the bottom of a BSOD issue I was having.&nbsp; Your BSOD issue(s) will be completely different, however the basics of using the Windows debugger and investigating the Windows debugger output will be the same.</b></i></span><br /><h2>Using Windows Debugging tools to find a BSOD root cause </h2>Start up WinDbg, and choose File - Open Crash Dump...<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-hAMTUKEbq1M/UIZ48b9qR4I/AAAAAAAABSA/dCJtvYCw4_w/s1600/OpenDump.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="https://lh3.ggpht.com/-hAMTUKEbq1M/UIZ48b9qR4I/AAAAAAAABSA/dCJtvYCw4_w/s1600/OpenDump.jpg" width="161" /></a></div><br />Open your MEMORY.DMP file.<br />Wait whilst the the debugger to does it's thing:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-tJGKtLaOKu0/UIZ7WyMgqwI/AAAAAAAABSY/o56M5pkkOeY/s1600/Dump1.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="https://lh3.ggpht.com/-tJGKtLaOKu0/UIZ7WyMgqwI/AAAAAAAABSY/o56M5pkkOeY/s1600/Dump1.JPG" width="393" /></a></div><br />If you have set up your debugging environment as described in part 1, you will be using the Microsoft symbols server.&nbsp; This is confirmed by the debugger when a debug is under way, as highlighted in the screenshot above.<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">Symbol search path is: SRV*c:\Symbols*http://msdl.microsoft.com/download/symbols</span><br /><br />OK so what can we see then?<br /><br />Firstly the details of the BSOD, or BugCheck as the debugger calls it:<br /><br /><div style="text-align: center;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;BugCheck 9F, {3, 84abc530, 82b65ae0, 86116de0}</span></div><br />OK, a STOP 9F... What is that?<br /><br />Looking at <a href="http://pcsupport.about.com/od/findbyerrormessage/tp/stop_error_list.htm" target="_blank">this handy list of BSOD codes (pcsupport.about.com)</a> a STOP 9F is described as follows: <br /><br /><div class="separator" style="clear: both; text-align: center;"></div><blockquote class="tr_bq"><b>STOP Error 0x0000009F: DRIVER_POWER_STATE_FAILURE</b><br />STOP error 0x9F means that the driver is in an inconsistent or invalid power state. STOP code 0x0000009F may also display "DRIVER_POWER_STATE_FAILURE" on the same STOP message.</blockquote><br />So some sort of driver issue when the system is changing power state.<br /><br />Next the debugger is suggesting that the BSOD was probably caused by ntkrpamp:<br /><br /><div style="text-align: center;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">Probably caused by : ntkrpamp</span></div><br />OK, whats a ntkrpamp?&nbsp; Searching for ntkrpamp at <a href="http://www.processlibrary.com/" target="_blank">processlibrary.com</a> shows the following:<br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-wUbQWjAP7QE/UIaADJTCyPI/AAAAAAAABS4/F9V24fKpvSc/s1600/ntkrpamp.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="238" src="https://lh3.ggpht.com/-wUbQWjAP7QE/UIaADJTCyPI/AAAAAAAABS4/F9V24fKpvSc/s1600/ntkrpamp.JPG" width="400" /></a></div><br />So ntkrpamp is the NT Kernel.&nbsp; That's not a driver!&nbsp; However it is the kernel's job to run drivers.&nbsp; We are going to need to do some further digging with the debugger.<br /><br />Luckily, the debugger makes it easy for us.&nbsp; Simply click the blue text <span style="color: blue;"><u><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">!analyze -v</span></u></span> in the debugger results window to perform some further analysis.<br />Here is the output:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-UM6U2ZSB_zc/UIaBSk7fD0I/AAAAAAAABTA/ZYkNshidL7w/s1600/Dump2.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="https://lh3.ggpht.com/-UM6U2ZSB_zc/UIaBSk7fD0I/AAAAAAAABTA/ZYkNshidL7w/s1600/Dump2.JPG" width="315" /></a></div><br />Right, now we are getting there.<span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;</span><br /><br /><div style="text-align: center;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">FAULTING_MODULE: 93d04000 dne2000</span></div>&nbsp;and<br /><div style="text-align: center;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">DEFAULT_BUCKET_ID:&nbsp; WIN7_DRIVER_FAULT </span></div><div style="text-align: center;"><br /></div>WIN7_DRIVER_FAULT that ties in with the BSOD being caused by a driver power state failure.&nbsp; However, what is this FAULTING_MODULE dne2000 ?<br /><br />Lets click on the&nbsp; <span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="color: blue;"><u>dne2000</u></span></span> link in the debugger window to find out:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-wqtzAJooqMg/UIaDmX51B1I/AAAAAAAABTI/lyfrjQ1VSNw/s1600/Dump3.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="https://lh3.ggpht.com/-wqtzAJooqMg/UIaDmX51B1I/AAAAAAAABTI/lyfrjQ1VSNw/s1600/Dump3.JPG" width="308" /></a></div><br />Oh look. dne2000.sys, a driver located in C:\Windows\system32\DRIVERS folder.<br /><br /><span style="font-size: small;"><b>Wa-hey! Root cause found<span style="font-size: small;"><span style="font-size: small;">:</span> The driver dne2000.sys is having issu<span style="font-size: small;">es<span style="font-size: small;">, causing the BSOD.<span style="font-size: small;"></span></span></span></span></b></span><br /><h2>Fixing the Root Cause</h2>So we know that there is an issue with the driver dne2000.sys that is causing the Windows BSOD. Lets get Google (other search engines are available) to take the strain from here on in.<br /><br />Something like <i><a href="http://www.google.co.uk/#hl=en&amp;site=&amp;source=hp&amp;q=dne2000.sys+bsod&amp;oq=dne2000&amp;gs_l=hp.3.1.0l6j0i30l2j0i10i30j0i30.2521.3861.0.5806.7.7.0.0.0.0.142.749.1j6.7.0.les%3B..0.0...1c.1.gIXe0XynpXE&amp;bav=on.2,or.r_gc.r_pw.&amp;fp=fd0593dffb307e1&amp;bpcl=35466521&amp;biw=1680&amp;bih=903" target="_blank">dne2000.sys bsod</a> </i>should do us nicely.<br /><br />The very first google search result points us to <a href="https://social.technet.microsoft.com/Forums/eu/itprovistasp/thread/7bef18ea-620c-40c5-b6be-b808a723bf15" target="_blank">this discussion thread on MS Technet Forums</a>&nbsp; Which in turn links us to <a href="https://www.citrix.com/lang/English/lp/lp_1680845.asp" target="_blank">this page discussing an available DNE update</a><br /><br />Following the advice and completing the installation of the DNEUpdate  and after a bit of extensive testing, my STOP 9F BSOD's are a thing of  the past.&nbsp; Job done! <br /><h2>Conclusion</h2>As I said at the top of the post, your BSOD may - probably will - be completely different to mine.&nbsp; However the basics of using the Windows debugger and investigating the Windows debugger output will be the same.&nbsp; The take away from this post is as follows:<br /><ol><li>How to use the Windows debugger to open a BSOD crash dump</li><li>How to find out more about the BSOD <a href="http://pcsupport.about.com/od/findbyerrormessage/tp/stop_error_list.htm" target="_blank">here</a></li><li>How to find out about Windows processes <a href="http://www.processlibrary.com/" target="_blank">here</a></li><li>How to use the Windows debugger !analyze -v function to find out more about the BSOD crash dump</li><li>How to use other links offered by the Windows debugger to find out more, such as file names etc</li><li>Finally, once you have an idea of BSOD the root cause, use a search engine to investigate further.&nbsp; Chances are you are not the first person to suffer with the issue!</li></ol>Happy debugging.<br /><br />- Chris <div class="blogger-post-footer"><p>

